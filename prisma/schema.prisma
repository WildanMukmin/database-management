generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Absensi {
  id             String     @id
  classAsdosId   String
  pertemuanKe    Int?
  waktuKehadiran DateTime?
  materi         String?    @default("materi...")
  ruangan        String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime
  fileId         String     @unique
  ClassAsdos     ClassAsdos @relation(fields: [classAsdosId], references: [id], onDelete: Cascade)
  File           File       @relation(fields: [fileId], references: [id])

  @@unique([classAsdosId, pertemuanKe])
}

model ActiveAbsensi {
  id              String   @id
  pertemuanActive Int[]
  updatedAt       DateTime
}

model Asdos {
  npm        String       @id
  userId     String       @unique
  createdAt  DateTime     @default(now())
  updatedAt  DateTime
  alasan     String?
  domisili   String?
  fileId     String?      @unique
  whatsapp   String?
  File       File?        @relation(fields: [fileId], references: [id], onDelete: Cascade)
  User       User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  ClassAsdos ClassAsdos[]
}

model AsdosApplication {
  id                      String              @id
  fileId                  String              @unique
  userId                  String              @unique
  npm                     String              @unique
  whatsapp                String
  domisili                String
  wawancara               String              @default("offline")
  alasanOnline            String?
  alasan                  String
  status                  String?             @default("processing")
  bersediaDuaMatkul       Boolean
  pengalamanAsdos         Boolean
  bersediaDitempatkanLain Boolean
  createdAt               DateTime            @default(now())
  updatedAt               DateTime
  jadwalWawancaraId       String?
  File                    File                @relation(fields: [fileId], references: [id], onDelete: Cascade)
  JadwalWawancara         JadwalWawancara?    @relation(fields: [jadwalWawancaraId], references: [id], onDelete: Cascade)
  User                    User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  CourseApplication       CourseApplication[]
  Penilaian               Penilaian?
}

model Class {
  id                String           @id
  courseId          String?
  name              String
  createdAt         DateTime         @default(now())
  updatedAt         DateTime
  jadwalPraktikumId String?          @unique
  Course            Course?          @relation(fields: [courseId], references: [id], onDelete: Cascade)
  JadwalPraktikum   JadwalPraktikum? @relation(fields: [jadwalPraktikumId], references: [id], onDelete: Cascade)
  ClassAsdos        ClassAsdos[]
  ClassDosen        ClassDosen[]

  @@unique([courseId, name])
}

model ClassAsdos {
  id        String    @id
  classId   String
  asdosNpm  String
  createdAt DateTime  @default(now())
  updatedAt DateTime
  Absensi   Absensi[]
  Asdos     Asdos     @relation(fields: [asdosNpm], references: [npm], onDelete: Cascade)
  Class     Class     @relation(fields: [classId], references: [id], onDelete: Cascade)

  @@unique([classId, asdosNpm])
}

model ClassDosen {
  id        String   @id
  classId   String
  dosenNip  String
  createdAt DateTime @default(now())
  updatedAt DateTime
  Class     Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  Dosen     Dosen    @relation(fields: [dosenNip], references: [nip], onDelete: Cascade)

  @@unique([classId, dosenNip])
}

model Course {
  id                String              @id
  code              String
  semesterId        String
  name              String
  sks               Int?                @default(3)
  kuota             Int?                @default(2)
  status            String?             @default("aktif")
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  Class             Class[]
  Semester          Semester            @relation(fields: [semesterId], references: [id], onDelete: Cascade)
  CourseApplication CourseApplication[]
}

model CourseApplication {
  id                 String           @id
  asdosApplicationId String
  courseId           String
  AsdosApplication   AsdosApplication @relation(fields: [asdosApplicationId], references: [id], onDelete: Cascade)
  Course             Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([asdosApplicationId, courseId])
}

model DataRepositori {
  id               String   @id
  dosenNip         String?
  thumbnail        String?
  namaDataset      String
  namaPemilik      String
  jenisDataset     String
  linkPublikasi    String
  linkRepositori   String
  deskripsiDataset String?
  status           String   @default("pending")
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  Dosen            Dosen?   @relation(fields: [dosenNip], references: [nip])
}

model Dosen {
  nip            String           @id
  userId         String?          @unique
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  namaDosen      String?
  ClassDosen     ClassDosen[]
  DataRepositori DataRepositori[]
  User           User?            @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model File {
  id               String            @id
  folderId         String?
  namaFile         String
  linkView         String
  linkDownload     String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  Absensi          Absensi?
  Asdos            Asdos?
  AsdosApplication AsdosApplication?
  Folder           Folder?           @relation(fields: [folderId], references: [id], onDelete: Cascade)
}

model Folder {
  id         String   @id
  parentId   String?
  namaFolder String
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  File       File[]
}

model GoogleRefreshToken {
  id    String @id
  token String
}

model Image {
  id        String   @id
  userId    String?  @unique
  namaFoto  String
  gambar    String
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model JadwalPraktikum {
  id        String   @id
  hari      String?
  mulai     String?
  selesai   String?
  ruangan   String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  Class     Class?
}

model JadwalWawancara {
  id               String             @id
  tanggal          String?            @default("Belum Diatur")
  hari             String?            @default("Belum Diatur")
  jam              String?            @default("Belum Diatur")
  lokasi           String?            @default("LAB LT3")
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  AsdosApplication AsdosApplication[]
}

model PasswordResetToken {
  id      String   @id
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model Penilaian {
  id                    String           @id
  asdosApplicationId    String           @unique
  ketepatanMenjawabSoal Int?             @default(0)
  penjelasanJawaban     Int?             @default(0)
  wawancara             Int?             @default(0)
  nilaiTotal            Int?             @default(0)
  createdAt             DateTime         @default(now())
  updatedAt             DateTime
  AsdosApplication      AsdosApplication @relation(fields: [asdosApplicationId], references: [id], onDelete: Cascade)
}

model Prodi {
  id        String     @id
  name      String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime
  Semester  Semester[]
}

model Semester {
  id             String   @id
  semesterNumber Int
  prodiId        String
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  Course         Course[]
  Prodi          Prodi    @relation(fields: [prodiId], references: [id], onDelete: Cascade)

  @@unique([semesterNumber, prodiId])
}

model User {
  id               String            @id
  name             String?
  email            String            @unique
  emailVerified    DateTime?
  password         String
  role             Role              @default(GUEST)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime
  Asdos            Asdos?
  AsdosApplication AsdosApplication?
  Dosen            Dosen?
  Image            Image?
}

model VerificationToken {
  id      String   @id
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

enum Role {
  ADMIN
  ASDOS
  CALON_ASDOS
  DOSEN
  GUEST
  LABORAN
}
